{"version":3,"sources":["../src/util/createCommand.ts","../src/util/createEvent.ts","../src/util/normalizeError.ts","../src/util/randomNumber.ts","../src/util/sendError.ts","../src/util/watchChanges.ts","../src/util/index.ts"],"sourcesContent":["import type {\r\n\tApplicationCommandOptionType,\r\n\tApplicationCommandType,\r\n} from \"discord-api-types/v10\";\r\nimport type { CommandOptions } from \"./types\";\r\n\r\n/**\r\n * This utility function is just to infer automatically the command type from the data.\r\n * @param command - The command data\r\n * @returns The command data\r\n */\r\nexport const createCommand = <\r\n\tT extends ApplicationCommandType,\r\n\tO extends ApplicationCommandOptionType,\r\n\tN extends string = string\r\n>(\r\n\tcommand: CommandOptions<T, O, N>\r\n) => command;\r\n\r\nexport default createCommand;\r\n","import type { ClientEvents } from \"discord.js\";\nimport type { EventOptions } from \"./types\";\n\n/**\n * This utility function is just to infer automatically event types from the data.\n * @param event - The event data\n * @returns The event data\n */\nexport const createEvent = <K extends keyof ClientEvents>(\n\tevent: EventOptions<K>\n) => event;\n\nexport default createEvent;\n","import CustomClient from \"./CustomClient\";\r\n\r\n/**\r\n * Normalize a promise rejection to a plain error object.\r\n * @param err - The error to normalize\r\n * @returns An Error object\r\n */\r\nexport const normalizeError = (err: unknown) => {\r\n\tCustomClient.printToStderr(err);\r\n\treturn err instanceof Error\r\n\t\t? err\r\n\t\t: new Error(typeof err === \"string\" ? err : \"Unknown error\");\r\n};\r\n\r\nexport default normalizeError;\r\n","/**\r\n * Get a random number between a min and max.\r\n * @param min - The minimum number\r\n * @param max - The maximum number\r\n * @returns A random number between min and max\r\n */\r\nexport const randomNumber: {\r\n\t(min: number, max: number): number;\r\n\t(): number;\r\n} = (min?: number, max?: number) =>\r\n\tmin === undefined\r\n\t\t? Math.random()\r\n\t\t: Math.floor(Math.random() * (max! - min + 1)) + min;\r\n\r\nexport default randomNumber;\r\n","import type { ReceivedInteraction } from \".\";\n\nexport const sendError = (interaction: ReceivedInteraction, error: Error) =>\n\tinteraction[interaction.deferred ? \"editReply\" : \"reply\"]({\n\t\tcontent: `Si Ã¨ verificato un errore: \\`${error.message.slice(0, 1000)}\\``,\n\t\tephemeral: true,\n\t});\n\nexport default sendError;\n","import { ApplicationCommandType } from \"discord-api-types/v10\";\nimport { unlink, watch } from \"node:fs/promises\";\nimport { join } from \"node:path\";\nimport { cwd } from \"node:process\";\nimport type { CommandOptions } from \".\";\nimport Command from \"./Command\";\nimport Constants from \"./Constants\";\nimport CustomClient from \"./CustomClient\";\n\nconst commandsFolder = join(cwd(), `src/${Constants.commandsFolderName}`);\nconst importCommand = (name: string, fresh = false) =>\n\t(\n\t\timport(\n\t\t\t`./${Constants.commandsFolderName}/${name.replace(/\\.ts$/, \".js\")}${\n\t\t\t\tfresh ? `?${Date.now()}` : \"\"\n\t\t\t}`\n\t\t) as Promise<{\n\t\t\tcommand: CommandOptions;\n\t\t}>\n\t)\n\t\t.then((c) => c.command)\n\t\t.catch(() => undefined);\n\nexport const watchChanges = async (client: CustomClient) => {\n\t// eslint-disable-next-line node/no-unpublished-import\n\tconst tsup = await import(\"tsup\").catch(() => {\n\t\tCustomClient.printToStderr(\n\t\t\t\"Failed to load tsup, not watching for changes...\"\n\t\t);\n\t});\n\n\tif (tsup)\n\t\tfor await (const event of watch(commandsFolder, {\n\t\t\tencoding: \"utf8\",\n\t\t\tpersistent: false,\n\t\t})) {\n\t\t\tconst oldCommand = await importCommand(event.filename, true);\n\n\t\t\tif (event.eventType === \"rename\" && oldCommand) {\n\t\t\t\tconst { name } =\n\t\t\t\t\toldCommand.data.find(\n\t\t\t\t\t\t({ type }) => type === ApplicationCommandType.ChatInput\n\t\t\t\t\t) ?? oldCommand.data[0];\n\t\t\t\tconst ok = client.commands.delete(name);\n\n\t\t\t\tunlink(\n\t\t\t\t\tnew URL(\n\t\t\t\t\t\t`${Constants.commandsFolderName}/${event.filename.replace(\n\t\t\t\t\t\t\t/\\.ts/,\n\t\t\t\t\t\t\t\".js\"\n\t\t\t\t\t\t)}`,\n\t\t\t\t\t\timport.meta.url\n\t\t\t\t\t)\n\t\t\t\t).catch(CustomClient.printToStderr);\n\t\t\t\tCustomClient.printToStdout(\n\t\t\t\t\tok\n\t\t\t\t\t\t? `Deleted ${event.filename}`\n\t\t\t\t\t\t: `Couldn't find command ${name} (${event.filename})`\n\t\t\t\t);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst failed = await tsup\n\t\t\t\t.build({\n\t\t\t\t\tconfig: false,\n\t\t\t\t\tentry: [`src/${Constants.commandsFolderName}/${event.filename}`],\n\t\t\t\t\tformat: \"esm\",\n\t\t\t\t\texternal: [\"tsup\"],\n\t\t\t\t\tminify: true,\n\t\t\t\t\tplatform: \"node\",\n\t\t\t\t\tsourcemap: true,\n\t\t\t\t\ttarget: \"ESNext\",\n\t\t\t\t\toutDir: join(cwd(), \"dist/commands\"),\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tCustomClient.printToStderr(`Failed to build ${event.filename}`);\n\t\t\t\t\tCustomClient.printToStderr(err);\n\t\t\t\t\treturn true as const;\n\t\t\t\t});\n\n\t\t\tif (failed) continue;\n\t\t\tconst newCommand = await importCommand(event.filename, true);\n\n\t\t\tif (newCommand) {\n\t\t\t\tif (oldCommand)\n\t\t\t\t\tclient.commands.delete(\n\t\t\t\t\t\toldCommand.data.find(\n\t\t\t\t\t\t\t({ type }) => type === ApplicationCommandType.ChatInput\n\t\t\t\t\t\t)?.name ?? oldCommand.data[0].name\n\t\t\t\t\t);\n\t\t\t\tconst { name } =\n\t\t\t\t\tnewCommand.data.find(\n\t\t\t\t\t\t({ type }) => type === ApplicationCommandType.ChatInput\n\t\t\t\t\t) ?? newCommand.data[0];\n\n\t\t\t\tclient.commands.set(name, new Command(client, newCommand));\n\t\t\t\tCustomClient.printToStdout(\n\t\t\t\t\t`${oldCommand ? \"Reloaded\" : \"Added\"} command ${name} (${\n\t\t\t\t\t\tevent.filename\n\t\t\t\t\t})`\n\t\t\t\t);\n\t\t\t} else CustomClient.printToStderr(`Cannot find new ${event.filename}`);\n\t\t}\n};\n\nexport default watchChanges;\n","import Constants from \"./Constants\";\r\n\r\nexport * from \"./calculateRam\";\r\nexport * from \"./cast\";\r\nexport * from \"./colors\";\r\nexport * from \"./Command\";\r\nexport * from \"./Constants\";\r\nexport * from \"./createCommand\";\r\nexport * from \"./createEvent\";\r\nexport * from \"./CustomClient\";\r\nexport * from \"./eval\";\r\nexport * from \"./Event\";\r\nexport * from \"./interactions\";\r\nexport * from \"./loadCommands\";\r\nexport * from \"./loadEvents\";\r\nexport * from \"./normalizeError\";\r\nexport * from \"./Queue\";\r\nexport * from \"./randomNumber\";\r\nexport * from \"./sendError\";\r\nexport * from \"./types\";\r\nexport * from \"./watchChanges\";\r\n\r\nexport default Constants;\r\n"],"mappings":"sDAWO,GAAM,GAAgB,AAK5B,GACI,ECTE,GAAM,GAAc,AAC1B,GACI,ECHE,GAAM,GAAiB,AAAC,GAC9B,GAAa,cAAc,CAAG,EACvB,YAAe,OACnB,EACA,GAAI,OAAM,MAAO,IAAQ,SAAW,EAAM,eAAe,GCLtD,GAAM,GAGT,CAAC,EAAc,IAClB,IAAQ,OACL,KAAK,OAAO,EACZ,KAAK,MAAM,KAAK,OAAO,EAAK,GAAO,EAAM,EAAE,EAAI,ECV5C,GAAM,GAAY,CAAC,EAAkC,IAC3D,EAAY,EAAY,SAAW,YAAc,SAAS,CACzD,QAAS,mCAAgC,EAAM,QAAQ,MAAM,EAAG,GAAI,MACpE,UAAW,EACZ,CAAC,ECNF,+DACA,qDACA,iCACA,mCAMA,GAAM,GAAiB,EAAK,EAAI,EAAG,OAAO,EAAU,oBAAoB,EAClE,EAAgB,CAAC,EAAc,EAAQ,KAE3C,OACC,KAAK,EAAU,sBAAsB,EAAK,QAAQ,QAAS,KAAK,IAC/D,EAAQ,IAAI,KAAK,IAAI,IAAM,MAM5B,KAAK,AAAC,GAAM,EAAE,OAAO,EACrB,MAAM,IAAG,EAAY,EAEX,EAAe,KAAO,IAAyB,CAE3D,GAAM,GAAO,KAAM,QAAO,QAAQ,MAAM,IAAM,CAC7C,EAAa,cACZ,kDACD,CACD,CAAC,EAED,GAAI,EACH,aAAiB,KAAS,GAAM,EAAgB,CAC/C,SAAU,OACV,WAAY,EACb,CAAC,EAAG,CACH,GAAM,GAAa,KAAM,GAAc,EAAM,SAAU,EAAI,EAE3D,GAAI,EAAM,YAAc,UAAY,EAAY,CAC/C,GAAM,CAAE,QACP,EAAW,KAAK,KACf,CAAC,CAAE,UAAW,IAAS,EAAuB,SAC/C,GAAK,EAAW,KAAK,GAChB,EAAK,EAAO,SAAS,OAAO,CAAI,EAEtC,EACC,GAAI,KACH,GAAG,EAAU,sBAAsB,EAAM,SAAS,QACjD,OACA,KACD,IACA,YAAY,GACb,CACD,EAAE,MAAM,EAAa,aAAa,EAClC,EAAa,cACZ,EACG,WAAW,EAAM,WACjB,yBAAyB,MAAS,EAAM,WAC5C,EACA,QACD,CAmBA,GAlBe,KAAM,GACnB,MAAM,CACN,OAAQ,GACR,MAAO,CAAC,OAAO,EAAU,sBAAsB,EAAM,UAAU,EAC/D,OAAQ,MACR,SAAU,CAAC,MAAM,EACjB,OAAQ,GACR,SAAU,OACV,UAAW,GACX,OAAQ,SACR,OAAQ,EAAK,EAAI,EAAG,eAAe,CACpC,CAAC,EACA,MAAM,AAAC,GACP,GAAa,cAAc,mBAAmB,EAAM,UAAU,EAC9D,EAAa,cAAc,CAAG,EACvB,GACP,EAEU,SACZ,GAAM,GAAa,KAAM,GAAc,EAAM,SAAU,EAAI,EAE3D,GAAI,EAAY,CACf,AAAI,GACH,EAAO,SAAS,OACf,EAAW,KAAK,KACf,CAAC,CAAE,UAAW,IAAS,EAAuB,SAC/C,GAAG,MAAQ,EAAW,KAAK,GAAG,IAC/B,EACD,GAAM,CAAE,QACP,EAAW,KAAK,KACf,CAAC,CAAE,UAAW,IAAS,EAAuB,SAC/C,GAAK,EAAW,KAAK,GAEtB,EAAO,SAAS,IAAI,EAAM,GAAI,GAAQ,EAAQ,CAAU,CAAC,EACzD,EAAa,cACZ,GAAG,EAAa,WAAa,mBAAmB,MAC/C,EAAM,WAER,CACD,KAAO,GAAa,cAAc,mBAAmB,EAAM,UAAU,CACtE,CACF,EChFA,GAAO,GAAQ","names":[]}