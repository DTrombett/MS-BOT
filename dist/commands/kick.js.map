{"version":3,"sources":["../../src/commands/kick.ts"],"sourcesContent":["import type { InteractionType, Snowflake } from \"discord-api-types/v10\";\nimport {\n\tApplicationCommandOptionType,\n\tApplicationCommandType,\n\tComponentType,\n\tTextInputStyle,\n} from \"discord-api-types/v10\";\nimport { escapeMarkdown, GuildMember } from \"discord.js\";\nimport type { InteractionByType, ReceivedInteraction } from \"../util\";\nimport {\n\tcreateCommand,\n\tCustomClient,\n\tEmojis,\n\tnormalizeError,\n\tsendError,\n} from \"../util\";\n\nconst checkPerms = async (\n\tinteraction: ReceivedInteraction<\"cached\">,\n\tid: Snowflake,\n\townerId: Snowflake,\n\tmember?: GuildMember\n) => {\n\tif (!member) {\n\t\tawait interaction.reply({\n\t\t\tcontent: \"L'utente non è nel server!\",\n\t\t\tephemeral: true,\n\t\t});\n\t\treturn true;\n\t}\n\tif (interaction.user.id !== ownerId) {\n\t\tif (!interaction.memberPermissions.has(\"KickMembers\")) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent:\n\t\t\t\t\t\"Hai bisogno del permesso **Espelli membri** per eseguire questa azione!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\t\tif (id === ownerId) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent: \"Non puoi eseguire questa azione sul proprietario del server!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\t\tif (\n\t\t\tmember.roles.highest.comparePositionTo(\n\t\t\t\tinteraction.member.roles.highest\n\t\t\t) >= 0\n\t\t) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent:\n\t\t\t\t\t\"Non puoi eseguire questa azione su un membro con una posizione superiore o uguale alla tua!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\t}\n\tif (!member.kickable) {\n\t\tawait interaction.reply({\n\t\t\tcontent: \"Non ho abbastanza permessi per espellere questo membro!\",\n\t\t\tephemeral: true,\n\t\t});\n\t\treturn true;\n\t}\n\treturn false;\n};\nconst executeKick = async (\n\tinteraction: ReceivedInteraction<\"cached\">,\n\tmember: GuildMember,\n\treason = \"\"\n) => {\n\tconst [error] = await Promise.all([\n\t\tmember\n\t\t\t.kick(reason || undefined)\n\t\t\t.then(() => undefined)\n\t\t\t.catch(normalizeError),\n\t\tinteraction.deferReply().catch(CustomClient.printToStderr),\n\t]);\n\n\tif (error) {\n\t\tawait sendError(interaction, error);\n\t\treturn;\n\t}\n\tawait interaction.editReply({\n\t\tcontent: `<:kick:${Emojis.kick}> <@${member.user.id}> (${escapeMarkdown(\n\t\t\tmember.user.tag\n\t\t)} - ${member.user.id}) è stato espulso!\\n\\nMotivo: ${\n\t\t\treason.length ? reason.slice(0, 1_000) : \"*Nessun motivo*\"\n\t\t}`,\n\t});\n};\nconst showModal = (\n\tinteraction: InteractionByType<\n\t\tInteractionType.ApplicationCommand | InteractionType.MessageComponent\n\t>,\n\tmember: GuildMember\n) =>\n\tinteraction.showModal({\n\t\ttitle: `Espelli ${member.user.username} dal server`,\n\t\tcustom_id: `kick-${member.id}`,\n\t\tcomponents: [\n\t\t\t{\n\t\t\t\ttype: ComponentType.ActionRow,\n\t\t\t\tcomponents: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: ComponentType.TextInput,\n\t\t\t\t\t\tcustom_id: \"reason\",\n\t\t\t\t\t\tlabel: \"Motivo dell'espulsione\",\n\t\t\t\t\t\tplaceholder:\n\t\t\t\t\t\t\t\"Inserisci un motivo. Sarà visibile solo nel registro attività e non sarà mostrato al membro.\",\n\t\t\t\t\t\tmax_length: 512,\n\t\t\t\t\t\tstyle: TextInputStyle.Paragraph,\n\t\t\t\t\t\trequired: false,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t],\n\t});\n\nexport const command = createCommand({\n\tdata: [\n\t\t{\n\t\t\ttype: ApplicationCommandType.ChatInput,\n\t\t\tname: \"kick\",\n\t\t\tdescription: \"Espelli utente\",\n\t\t\toptions: [\n\t\t\t\t{\n\t\t\t\t\tname: \"member\",\n\t\t\t\t\tdescription: \"Il membro da espellere\",\n\t\t\t\t\ttype: ApplicationCommandOptionType.User,\n\t\t\t\t\trequired: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"reason\",\n\t\t\t\t\tdescription: \"Il motivo dell'espulsione, se presente\",\n\t\t\t\t\ttype: ApplicationCommandOptionType.String,\n\t\t\t\t\tmax_length: 512,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\ttype: ApplicationCommandType.User,\n\t\t\tname: \"Espelli\",\n\t\t},\n\t],\n\tasync run(interaction) {\n\t\tif (!interaction.inCachedGuild()) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent:\n\t\t\t\t\t\"Questo comando può essere usato solo all'interno di un server!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tconst option = interaction.options.data.find(\n\t\t\t(o) => o.type === ApplicationCommandOptionType.User\n\t\t);\n\t\tconst user = option?.user;\n\n\t\tif (!user) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent: \"Utente non trovato!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tconst { guild } = interaction;\n\t\tconst member =\n\t\t\toption.member instanceof GuildMember\n\t\t\t\t? option.member\n\t\t\t\t: await guild.members.fetch(user.id).catch(() => undefined);\n\n\t\tif (await checkPerms(interaction, user.id, guild.ownerId, member)) return;\n\t\tif (interaction.commandName === \"Espelli\") {\n\t\t\tawait showModal(interaction, member!);\n\t\t\treturn;\n\t\t}\n\t\tconst reason = interaction.options.data.find(\n\t\t\t(o) => o.name === \"reason\"\n\t\t)?.value;\n\n\t\tawait executeKick(\n\t\t\tinteraction,\n\t\t\tmember!,\n\t\t\ttypeof reason === \"string\" ? reason : undefined\n\t\t);\n\t},\n\tasync modalSubmit(interaction) {\n\t\tconst [, id] = interaction.customId.split(\"-\");\n\n\t\tif (!id) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent: \"Utente non trovato!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tif (!interaction.inCachedGuild()) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent:\n\t\t\t\t\t\"Questo comando può essere usato solo all'interno di un server!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tconst { guild } = interaction;\n\t\tconst member = await guild.members.fetch(id).catch(() => undefined);\n\n\t\tif (await checkPerms(interaction, id, guild.ownerId, member)) return;\n\t\tawait executeKick(\n\t\t\tinteraction,\n\t\t\tmember!,\n\t\t\tinteraction.fields.fields.get(\"reason\")?.value\n\t\t);\n\t},\n});\n"],"mappings":"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","names":[]}