import{a as h,c as l,e as p}from"../chunk-R2SJYMZV.js";import{d}from"../chunk-R24UT4ZV.js";import{ApplicationCommandOptionType as i,ApplicationCommandType as c,ButtonStyle as M,ComponentType as u,TextInputStyle as w}from"discord-api-types/v10";import{escapeMarkdown as S,GuildMember as R}from"discord.js";import v from"ms";var f=async(e,t,n,o)=>{if(!o)return await e.reply({content:"L'utente non \xE8 nel server.",ephemeral:!0}),!0;if(e.user.id!==n){if(!e.memberPermissions.has("ModerateMembers"))return await e.reply({content:"Hai bisogno del permesso **Metti i membri in Time out** per eseguire questa azione!",ephemeral:!0}),!0;if(t===n)return await e.reply({content:"Non puoi eseguire questa azione sul proprietario del server!",ephemeral:!0}),!0;if(o.roles.highest.comparePositionTo(e.member.roles.highest)>=0)return await e.reply({content:"Non puoi eseguire questa azione su un membro con una posizione superiore o uguale alla tua!",ephemeral:!0}),!0}return o.moderatable?!1:(await e.reply({content:"Non ho abbastanza permessi per moderare questo membro!",ephemeral:!0}),!0)},T=async(e,t,n,o="")=>{let[r]=await Promise.all([t.timeout(n,o||void 0).then(()=>{}).catch(l),e.deferReply().catch(d.printToStderr)]);if(r){await p(e,r);return}let a=Math.round((Date.now()+n)/1e3);await e.editReply({content:`Ho applicato il Time out a <@${t.user.id}> (${S(t.user.tag)} - ${t.user.id}) fino a <t:${a}:F> (<t:${a}:R>)!

Motivo: ${o.length?o.slice(0,1e3):"*Nessun motivo*"}`,components:[{type:u.ActionRow,components:[{type:u.Button,custom_id:`timeout-${t.user.id}-r`,style:M.Danger,label:"Annulla Time out"}]}]})},g=async(e,t)=>t==null||isNaN(t)||t<1e3?(await e.reply({content:"La durata non \xE8 valida! Esempi: `1m`, `1h`, `1d`.",ephemeral:!0}),!0):!1,b=(e,t)=>e.showModal({title:`Applica Time out a ${t.displayName}`,custom_id:`timeout-${t.id}`,components:[{type:u.ActionRow,components:[{type:u.TextInput,custom_id:"duration",label:"Durata",placeholder:"Esempi: 1h, 1d, 1w",required:!0,style:w.Short,value:"1m",min_length:2}]},{type:u.ActionRow,components:[{type:u.TextInput,custom_id:"reason",label:"Motivo",placeholder:"Inserisci un motivo. Sar\xE0 visibile solo nel registro attivit\xE0 e non sar\xE0 mostrato al membro.",max_length:512,style:w.Paragraph,required:!1}]}]}),I=async(e,t,n="")=>{if(!t.isCommunicationDisabled()){await e.reply({content:"Il membro non \xE8 in Time out!",ephemeral:!0});return}let[o]=await Promise.all([t.timeout(null,n||void 0).then(()=>{}).catch(l),e.deferReply().catch(d.printToStderr)]);if(o){await p(e,o);return}await e.editReply({content:`Time out di <@${t.user.id}> (${S(t.user.tag)} - ${t.user.id}) annullato!

Motivo: ${n.length?n.slice(0,1e3):"*Nessun motivo*"}`,components:[{type:u.ActionRow,components:[{type:u.Button,custom_id:`timeout-${t.user.id}-a`,label:"Applica Time out",style:M.Success}]}]})},N=h({data:[{type:c.ChatInput,name:"timeout",description:"Metti utente in Time out o rimuovilo",options:[{name:"add",description:"Metti utente in Time out",type:i.Subcommand,options:[{name:"user",description:"L'utente da mettere in Time out",type:i.User,required:!0},{name:"duration",description:"Per quanto tempo sar\xE0 messo in Time out",type:i.String,required:!0},{name:"reason",description:"Il motivo del Time out, se presente",type:i.String}]},{name:"remove",description:"Annulla Time out",type:i.Subcommand,options:[{name:"user",description:"L'utente da rimuovere dal Time out",type:i.User,required:!0},{name:"reason",description:"Il motivo dell'annullamento del Time out, se presente",type:i.String}]}]},{type:c.User,name:"Applica Time out"}],async run(e){if(!e.inCachedGuild()){await e.reply({content:"Questo comando pu\xF2 essere solo usato in un server!",ephemeral:!0});return}let t=e.commandType===c.User?e.options.data:e.options.data[0].options;if(!t){await e.reply({content:"Questo comando non \xE8 attualmente disponibile!",ephemeral:!0});return}let n=t.find(s=>s.type===i.User),o=n?.user;if(!o){await e.reply({content:"Utente non trovato!",ephemeral:!0});return}let{guild:r}=e,a=n.member instanceof R?n.member:await r.members.fetch(o.id).catch(()=>{});if(await f(e,o.id,r.ownerId,a))return;if(e.commandName==="Applica Time out"){await b(e,a);return}let m=t.find(s=>s.name==="reason")?.value;if(e.options.data[0].name==="add"){let s=t.find(A=>A.name==="duration")?.value,y=typeof s=="string"?v(s):void 0;if(await g(e,y))return;await T(e,a,y,typeof m=="string"?m:void 0);return}await I(e,a,typeof m=="string"?m:void 0)},async modalSubmit(e){let t=e.fields.fields.get("duration")?.value,n=t===void 0?void 0:v(t);if(await g(e,n))return;let[,o]=e.customId.split("-");if(!o){await e.reply({content:"Utente non trovato!",ephemeral:!0});return}if(!e.inCachedGuild()){await e.reply({content:"Questo comando pu\xF2 essere solo usato in un server!",ephemeral:!0});return}let{guild:r}=e,a=await r.members.fetch(o).catch(()=>{});await f(e,o,r.ownerId,a)||await T(e,a,n,e.fields.fields.get("reason")?.value)},async component(e){if(!e.inCachedGuild()){await e.reply({content:"Questo comando pu\xF2 essere solo usato in un server!",ephemeral:!0});return}let[,t,n]=e.customId.split("-");if(!t){await e.reply({content:"Utente non trovato!",ephemeral:!0});return}if(!n||!["a","r"].includes(n)){await e.reply({content:"Azione non valida!",ephemeral:!0});return}let{guild:o}=e,r=await o.members.fetch(t).catch(()=>{});if(!await f(e,t,o.ownerId,r)){if(n==="a"){await b(e,r);return}await I(e,r,void 0)}}});export{N as command};
//# sourceMappingURL=timeout.js.map