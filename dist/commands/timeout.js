import{a as h,c as d,e as p}from"../chunk-L6YZVJZB.js";import{d as m}from"../chunk-UUWUPXYS.js";import{ApplicationCommandOptionType as i,ApplicationCommandType as c,ButtonStyle as M,ComponentType as u,TextInputStyle as w}from"discord-api-types/v10";import{escapeMarkdown as S,GuildMember as A}from"discord.js";import v from"ms";var f=async(e,t,o,n)=>{if(!n)return await e.reply({content:"L'utente non \xE8 nel server.",ephemeral:!0}),!0;if(e.user.id!==o){if(!e.memberPermissions.has("ModerateMembers"))return await e.reply({content:"Hai bisogno del permesso **Metti i membri in Time out** per eseguire questa azione!",ephemeral:!0}),!0;if(t===o)return await e.reply({content:"Non puoi eseguire questa azione sul proprietario del server!",ephemeral:!0}),!0;if(n.roles.highest.comparePositionTo(e.member.roles.highest)>=0)return await e.reply({content:"Non puoi eseguire questa azione su un membro con una posizione superiore o uguale alla tua!",ephemeral:!0}),!0}return n.moderatable?!1:(await e.reply({content:"Non ho abbastanza permessi per moderare questo membro!",ephemeral:!0}),!0)},T=async(e,t,o,n="")=>{let[r]=await Promise.all([t.timeout(o,n||void 0).then(()=>{}).catch(d),e.deferReply().catch(m.printToStderr)]);if(r){await p(e,r);return}let a=Math.round((Date.now()+o)/1e3);await e.editReply({content:`Ho applicato il Time out a <@${t.user.id}> (${S(t.user.tag)} - ${t.user.id}) fino a <t:${a}:F> (<t:${a}:R>)!

Motivo: ${n.length?n.slice(0,1e3):"*Nessun motivo*"}`,components:[{type:u.ActionRow,components:[{type:u.Button,custom_id:`timeout-${t.user.id}-r`,style:M.Danger,label:"Annulla Time out"}]}]})},g=async(e,t)=>t==null||isNaN(t)||t<1e3?(await e.reply({content:"La durata non \xE8 valida! Esempi: `1m`, `1h`, `1d`.",ephemeral:!0}),!0):!1,b=(e,t)=>{let{displayName:o}=t;return e.showModal({title:`Applica Time out a ${o.length>26?`${o.slice(0,23)}...`:o}`,custom_id:`timeout-${t.id}`,components:[{type:u.ActionRow,components:[{type:u.TextInput,custom_id:"duration",label:"Durata",placeholder:"Esempi: 1h, 1d, 1w",required:!0,style:w.Short,value:"1m",min_length:2}]},{type:u.ActionRow,components:[{type:u.TextInput,custom_id:"reason",label:"Motivo",placeholder:"Inserisci un motivo. Sar\xE0 visibile solo nel registro attivit\xE0 e non sar\xE0 mostrato al membro.",max_length:512,style:w.Paragraph,required:!1}]}]})},I=async(e,t,o="")=>{if(!t.isCommunicationDisabled()){await e.reply({content:"Il membro non \xE8 in Time out!",ephemeral:!0});return}let[n]=await Promise.all([t.timeout(null,o||void 0).then(()=>{}).catch(d),e.deferReply().catch(m.printToStderr)]);if(n){await p(e,n);return}await e.editReply({content:`Time out di <@${t.user.id}> (${S(t.user.tag)} - ${t.user.id}) annullato!

Motivo: ${o.length?o.slice(0,1e3):"*Nessun motivo*"}`,components:[{type:u.ActionRow,components:[{type:u.Button,custom_id:`timeout-${t.user.id}-a`,label:"Applica Time out",style:M.Success}]}]})},N=h({data:[{type:c.ChatInput,name:"timeout",description:"Metti utente in Time out o rimuovilo",options:[{name:"add",description:"Metti utente in Time out",type:i.Subcommand,options:[{name:"user",description:"L'utente da mettere in Time out",type:i.User,required:!0},{name:"duration",description:"Per quanto tempo sar\xE0 messo in Time out",type:i.String,required:!0},{name:"reason",description:"Il motivo del Time out, se presente",type:i.String}]},{name:"remove",description:"Annulla Time out",type:i.Subcommand,options:[{name:"user",description:"L'utente da rimuovere dal Time out",type:i.User,required:!0},{name:"reason",description:"Il motivo dell'annullamento del Time out, se presente",type:i.String}]}]},{type:c.User,name:"Applica Time out"}],async run(e){if(!e.inCachedGuild()){await e.reply({content:"Questo comando pu\xF2 essere usato solo all'interno di un server!",ephemeral:!0});return}let t=e.commandType===c.User?e.options.data:e.options.data[0].options;if(!t){await e.reply({content:"Questo comando non \xE8 attualmente disponibile!",ephemeral:!0});return}let o=t.find(s=>s.type===i.User),n=o?.user;if(!n){await e.reply({content:"Utente non trovato!",ephemeral:!0});return}let{guild:r}=e,a=o.member instanceof A?o.member:await r.members.fetch(n.id).catch(()=>{});if(await f(e,n.id,r.ownerId,a))return;if(e.commandName==="Applica Time out"){await b(e,a);return}let l=t.find(s=>s.name==="reason")?.value;if(e.options.data[0].name==="add"){let s=t.find($=>$.name==="duration")?.value,y=typeof s=="string"?v(s):void 0;if(await g(e,y))return;await T(e,a,y,typeof l=="string"?l:void 0);return}await I(e,a,typeof l=="string"?l:void 0)},async modalSubmit(e){let t=e.fields.fields.get("duration")?.value,o=t===void 0?void 0:v(t);if(await g(e,o))return;let[,n]=e.customId.split("-");if(!n){await e.reply({content:"Utente non trovato!",ephemeral:!0});return}if(!e.inCachedGuild()){await e.reply({content:"Questo comando pu\xF2 essere usato solo all'interno di un server!",ephemeral:!0});return}let{guild:r}=e,a=await r.members.fetch(n).catch(()=>{});await f(e,n,r.ownerId,a)||await T(e,a,o,e.fields.fields.get("reason")?.value)},async component(e){if(!e.inCachedGuild()){await e.reply({content:"Questo comando pu\xF2 essere usato solo all'interno di un server!",ephemeral:!0});return}let[,t,o]=e.customId.split("-");if(!t){await e.reply({content:"Utente non trovato!",ephemeral:!0});return}if(!o||!["a","r"].includes(o)){await e.reply({content:"Azione non valida!",ephemeral:!0});return}let{guild:n}=e,r=await n.members.fetch(t).catch(()=>{});if(!await f(e,t,n.ownerId,r)){if(o==="a"){await b(e,r);return}await I(e,r,void 0)}}});export{N as command};
//# sourceMappingURL=timeout.js.map