import{a as w}from"../chunk-L6YZVJZB.js";import{d as f}from"../chunk-UUWUPXYS.js";import{codeBlock as I}from"@discordjs/builders";import{ApplicationCommandOptionType as m,ApplicationCommandType as E}from"discord-api-types/v10";import{Colors as A,escapeCodeBlock as x}from"discord.js";import L,{once as P}from"node:events";import{performance as v}from"node:perf_hooks";import{nextTick as b}from"node:process";import{REPL_MODE_STRICT as R,start as $}from"node:repl";import{Readable as B,Writable as O}from"node:stream";var y=new B({highWaterMark:1e6,encoding:"utf8",read:()=>{}}),h=new L({captureRejections:!0}),a=$({input:y,output:new O({defaultEncoding:"utf8",highWaterMark:1e6,decodeStrings:!1,write:(e,n,i)=>{h.emit("data",e),i()}}),prompt:"",replMode:R}),C=e=>{a.context.command=k,a.context.replServer=a,a.context.interaction=e,a.context.client=e.client},T=e=>{let{options:n}=a.writer,i=e.guild?.presences.cache.get(e.user.id)?.clientStatus,s=i?.desktop!=null&&i.mobile==null;n.colors=s,n.showHidden=e.options.getBoolean("show-hidden")??!1,n.depth=e.options.getInteger("depth")??3,n.showProxy=e.options.getBoolean("show-proxy")??!0,n.maxArrayLength=e.options.getInteger("max-array-length")??100,n.maxStringLength=e.options.getInteger("max-string-length")??1e3,n.breakLength=s?66:39},k=w({data:[{name:"eval",description:"Esegui del codice JavaScript",type:E.ChatInput,options:[{type:m.String,name:"code",description:"Codice da eseguire",required:!0,autocomplete:!0},{type:m.Boolean,name:"show-hidden",description:"Se mostrare le propriet\xE0 nascoste (default: false)"},{type:m.Integer,name:"depth",description:"Profondit\xE0 di esecuzione (default: 3)"},{type:m.Boolean,name:"show-proxy",description:"Se includere le propriet\xE0 proxy (default: true)"},{type:m.Integer,name:"max-array-length",description:"Il numero massimo di elementi da mostrare in un array (default: 100)"},{type:m.Integer,name:"max-string-length",description:"Il numero massimo di caratteri da mostrare in una stringa (default: 1000)"},{type:m.Boolean,name:"ephemeral",description:"Se il risultato pu\xF2 essere visto solo da te (default: true)"}]}],isPrivate:!0,async run(e){let n=e.options.getString("code",!0),i=e.options.getBoolean("ephemeral")??!0,s,u=v.now(),[c]=await Promise.all([new Promise(g=>{let d="",p,r=l=>{l=l.trim(),l&&(clearImmediate(p),s=v.now()-u,d+=`
${l}`,p=setImmediate(()=>{g(d),h.removeListener("data",r),delete a.context.interaction}))};h.on("data",r),T(e),C(e),y.push(`${n}
`)}),e.deferReply({ephemeral:i}).catch(f.printToStderr)]);await e.editReply({content:`Eval elaborato in ${s}ms`,embeds:[{author:{name:e.user.tag,icon_url:e.user.displayAvatarURL()},title:"Eval output",description:I("ansi",x(c).slice(0,4096-11)),color:A.Blurple,timestamp:new Date().toISOString(),fields:[{name:"Input",value:I("js",x(n).slice(0,1024-9))}]}]})},async autocomplete(e){let n=e.options.getFocused(!0);if(n.name!=="code")return;if(n.value.length>=100){await e.respond([]);return}C(e);let i=n.value.split(`
`),s=`${i.slice(0,-1).join(" ")} `.trim(),u=i.at(-1),[c,g]=await new Promise(t=>{a.completer(u,(o,S)=>{o&&f.printToStderr(o),t(S??[[],""])})});if(c.length===0){await e.respond([]),delete a.context.interaction;return}let d=[],p=[],r=c.find(t=>c.every(o=>o.startsWith(t)));for(let t of c){if(!t||p.length>=25){d.push(p),p=[];continue}if(r&&r===t)continue;let o=`${s}${u.replace(new RegExp(`${g}$`),t)}`;o.length>100||p.push({name:o,value:o})}d.push(p);let l=d.reverse().flat().slice(0,25);if(r&&!s&&g===u){let{options:t}=a.writer;t.colors=!1,t.showHidden=!1,t.depth=2,t.showProxy=!1,t.maxArrayLength=10,t.maxStringLength=100,t.breakLength=1/0,t.compact=!0,b(()=>y.push(`${r}
`));let[o]=await P(h,"data");if(o=o.trim(),o.length>100&&(o=`${o.slice(0,97).trimEnd()}...`),o){delete a.context.interaction,r=r.slice(0,100),await e.respond([{name:o,value:r},{name:r,value:r},...l]);return}}delete a.context.interaction,await e.respond(l)}});export{k as command};
//# sourceMappingURL=eval.js.map