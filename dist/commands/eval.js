import{a as y}from"../chunk-L6YZVJZB.js";import{d as h}from"../chunk-UUWUPXYS.js";import{codeBlock as w}from"@discordjs/builders";import{ApplicationCommandOptionType as m,ApplicationCommandType as S}from"discord-api-types/v10";import{Colors as E,escapeCodeBlock as I}from"discord.js";import A,{once as B}from"node:events";import{performance as x}from"node:perf_hooks";import{nextTick as L}from"node:process";import{REPL_MODE_STRICT as P,start as b}from"node:repl";import{Readable as R,Writable as $}from"node:stream";var f=new R({highWaterMark:1e6,encoding:"utf8",read:()=>{}}),g=new A({captureRejections:!0}),r=b({input:f,output:new $({defaultEncoding:"utf8",highWaterMark:1e6,decodeStrings:!1,write:(e,n,i)=>{g.emit("data",e),i()}}),prompt:"",replMode:P}),v=e=>{r.context.command=T,r.context.replServer=r,r.context.interaction=e,r.context.client=e.client},O=e=>{let{options:n}=r.writer,i=e.guild?.presences.cache.get(e.user.id)?.clientStatus,s=i?.desktop!=null&&i.mobile==null;n.colors=s,n.showHidden=e.options.getBoolean("show-hidden")??!1,n.depth=e.options.getInteger("depth")??3,n.showProxy=e.options.getBoolean("show-proxy")??!0,n.maxArrayLength=e.options.getInteger("max-array-length")??100,n.maxStringLength=e.options.getInteger("max-string-length")??1e3,n.breakLength=s?66:39},T=y({data:[{name:"eval",description:"Esegui del codice JavaScript",type:S.ChatInput,options:[{type:m.String,name:"code",description:"Codice da eseguire",required:!0,autocomplete:!0},{type:m.Boolean,name:"show-hidden",description:"Se mostrare le propriet\xE0 nascoste (default: false)"},{type:m.Integer,name:"depth",description:"Profondit\xE0 di esecuzione (default: 3)"},{type:m.Boolean,name:"show-proxy",description:"Se includere le propriet\xE0 proxy (default: true)"},{type:m.Integer,name:"max-array-length",description:"Il numero massimo di elementi da mostrare in un array (default: 100)"},{type:m.Integer,name:"max-string-length",description:"Il numero massimo di caratteri da mostrare in una stringa (default: 1000)"},{type:m.Boolean,name:"ephemeral",description:"Se il risultato pu\xF2 essere visto solo da te (default: true)"}]}],isPrivate:!0,async run(e){let n=e.options.getString("code",!0),i=e.options.getBoolean("ephemeral")??!0,s,c=x.now(),[p]=await Promise.all([new Promise(u=>{let a="",d,l=t=>{t=t.trim(),t&&(clearImmediate(d),s=x.now()-c,a+=`
${t}`,d=setImmediate(()=>{u(a),g.removeListener("data",l),delete r.context.interaction}))};g.on("data",l),O(e),v(e),f.push(`${n}
`)}),e.deferReply({ephemeral:i}).catch(h.printToStderr)]);await e.editReply({content:`Eval elaborato in ${s}ms`,embeds:[{author:{name:e.user.tag,icon_url:e.user.displayAvatarURL()},title:"Eval output",description:w("ansi",I(p).slice(0,4096-11)),color:E.Blurple,timestamp:new Date().toISOString(),fields:[{name:"Input",value:w("js",I(n).slice(0,1024-9))}]}]})},async autocomplete(e){let n=e.options.getFocused(!0);if(n.name!=="code")return;if(n.value.length>=100){await e.respond([]);return}v(e);let i=n.value.split(`
`),s=`${i.slice(0,-1).join(" ")} `.trim(),c=i.at(-1),[p,u]=await new Promise(t=>{r.completer(c,(o,C)=>{o&&h.printToStderr(o),t(C??[[],""])})});if(p.length===0){await e.respond([]),delete r.context.interaction;return}let a;if((p.length===1||(a=p.find(t=>p.every(o=>o.startsWith(t)))))&&!s&&u===c){let{options:t}=r.writer;a??=p[0],L(()=>f.push(`${a}
`)),t.colors=!1,t.showHidden=e.options.getBoolean("show-hidden")??!1,t.depth=e.options.getInteger("depth")??2,t.showProxy=e.options.getBoolean("show-proxy")??!1,t.maxArrayLength=e.options.getInteger("max-array-length")??100,t.maxStringLength=e.options.getInteger("max-string-length")??1e3,t.breakLength=1/0,t.compact=!0;let[o]=await B(g,"data");if(o=o.trim(),o.length>100&&(o=`${o.slice(0,97).trimEnd()}...`),o){delete r.context.interaction,a=a.slice(0,100),await e.respond([{name:a,value:a},{name:o,value:a}]);return}}let d=[],l=[];for(let t of p){if(!t||l.length>=25){d.push(l),l=[];continue}let o=`${s}${c.replace(new RegExp(`${u}$`),t)}`;o.length>100||l.push({name:o,value:o})}d.push(l),delete r.context.interaction,await e.respond(d.reverse().flat().slice(0,25))}});export{T as command};
//# sourceMappingURL=eval.js.map