import{a as y}from"../chunk-L6YZVJZB.js";import{d as h}from"../chunk-UUWUPXYS.js";import{codeBlock as w}from"@discordjs/builders";import{ApplicationCommandOptionType as p,ApplicationCommandType as v}from"discord-api-types/v10";import{Colors as S,escapeCodeBlock as x}from"discord.js";import E,{once as b}from"node:events";import{performance as I}from"node:perf_hooks";import{nextTick as A}from"node:process";import{REPL_MODE_STRICT as B,start as L}from"node:repl";import{Readable as P,Writable as R}from"node:stream";var f=new P({highWaterMark:1e6,encoding:"utf8",read:()=>{}}),u=new E({captureRejections:!0}),r=L({input:f,output:new R({defaultEncoding:"utf8",highWaterMark:1e6,decodeStrings:!1,write:(e,n,i)=>{u.emit("data",e),i()}}),prompt:"",replMode:B}),C=e=>{r.context.command=O,r.context.replServer=r,r.context.interaction=e,r.context.client=e.client},$=e=>{let{options:n}=r.writer,i=!e.guild?.presences.cache.get(e.user.id)?.clientStatus?.mobile;n.colors=i,n.showHidden=e.options.getBoolean("show-hidden")??!1,n.depth=e.options.getInteger("depth")??3,n.showProxy=e.options.getBoolean("show-proxy")??!0,n.maxArrayLength=e.options.getInteger("max-array-length")??100,n.maxStringLength=e.options.getInteger("max-string-length")??1e3,n.breakLength=i?66:39},O=y({data:[{name:"eval",description:"Esegui del codice JavaScript",type:v.ChatInput,options:[{type:p.String,name:"code",description:"Codice da eseguire",required:!0,autocomplete:!0},{type:p.Boolean,name:"show-hidden",description:"Se mostrare le propriet\xE0 nascoste (default: false)"},{type:p.Integer,name:"depth",description:"Profondit\xE0 di esecuzione (default: 3)"},{type:p.Boolean,name:"show-proxy",description:"Se includere le propriet\xE0 proxy (default: true)"},{type:p.Integer,name:"max-array-length",description:"Il numero massimo di elementi da mostrare in un array (default: 100)"},{type:p.Integer,name:"max-string-length",description:"Il numero massimo di caratteri da mostrare in una stringa (default: 1000)"},{type:p.Boolean,name:"ephemeral",description:"Se il risultato pu\xF2 essere visto solo da te (default: true)"}]}],isPrivate:!0,async run(e){let n=e.options.getString("code",!0),i=e.options.getBoolean("ephemeral")??!0,m,d=I.now(),[a]=await Promise.all([new Promise(c=>{let l,s=0,o=t=>{t=t.trim(),t&&(m=I.now()-d,s=Math.random(),l=t,setImmediate(g=>{g===s&&(c(l),u.removeListener("data",o),delete r.context.interaction)},s))};u.on("data",o),$(e),C(e),f.push(`${n}
`)}),e.deferReply({ephemeral:i}).catch(h.printToStderr)]);await e.editReply({content:`Eval elaborato in ${m}ms`,embeds:[{author:{name:e.user.tag,icon_url:e.user.displayAvatarURL()},title:"Eval output",description:w("ansi",x(a).slice(0,4096-11)),color:S.Blurple,timestamp:new Date().toISOString(),fields:[{name:"Input",value:w("js",x(n).slice(0,1024-9))}]}]})},async autocomplete(e){let n=e.options.getFocused(!0);if(n.name!=="code")return;if(n.value.length>=100){await e.respond([]);return}C(e);let i=n.value.split(`
`),m=`${i.slice(0,-1).join(" ")} `.trim(),d=i.at(-1),[a,c]=await new Promise(o=>{r.completer(d,(t,g)=>{t&&h.printToStderr(t),o(g??[[],""])})});if(a.length===0){await e.respond([]),delete r.context.interaction;return}if(a.length===1&&!m&&c===d){let{options:o}=r.writer;A(()=>f.push(`${a[0]}
`)),o.colors=!1,o.showHidden=e.options.getBoolean("show-hidden")??!1,o.depth=e.options.getInteger("depth")??2,o.showProxy=e.options.getBoolean("show-proxy")??!1,o.maxArrayLength=e.options.getInteger("max-array-length")??100,o.maxStringLength=e.options.getInteger("max-string-length")??1e3,o.breakLength=1/0,o.compact=!0;let[t]=await b(u,"data");if(t=t.trim(),t.length>100&&(t=`${t.slice(0,97).trimEnd()}...`),t){delete r.context.interaction,a[0]=a[0].slice(0,100),await e.respond([{name:a[0],value:a[0]},{name:t,value:a[0]}]);return}}let l=[],s=[];for(let o of a){if(!o||s.length>=25){l.push(s),s=[];continue}let t=`${m}${d.replace(new RegExp(`${c}$`),o)}`;t.length>100||s.push({name:t,value:t})}l.push(s),delete r.context.interaction,await e.respond(l.reverse().flat().slice(0,25))}});export{O as command};
//# sourceMappingURL=eval.js.map