{"version":3,"sources":["../../src/commands/channel.ts"],"sourcesContent":["import {\n\tApplicationCommandOptionType,\n\tApplicationCommandType,\n\tButtonStyle,\n\tComponentType,\n} from \"discord-api-types/v10\";\nimport type {\n\tGuildBasedChannel,\n\tNewsChannel,\n\tPrivateThreadChannel,\n\tPublicThreadChannel,\n\tTextChannel,\n} from \"discord.js\";\nimport ms from \"ms\";\nimport type { ReceivedInteraction } from \"../util\";\nimport { createCommand, normalizeError, sendError } from \"../util\";\n\ntype CheckSlowmodeOptions = {\n\tchannel: GuildBasedChannel | null | undefined;\n\trateLimitPerUser: number;\n\treason?: string;\n};\ntype SlowmodeOptions = {\n\tchannel:\n\t\t| NewsChannel\n\t\t| PrivateThreadChannel\n\t\t| PublicThreadChannel\n\t\t| TextChannel;\n\trateLimitPerUser: number;\n\treason?: string;\n};\n\nconst checkPerms = async (interaction: ReceivedInteraction<\"cached\">) => {\n\tif (!interaction.memberPermissions.has(\"ManageChannels\")) {\n\t\tawait interaction.reply({\n\t\t\tcontent: \"Non hai i permessi necessari per usare questo comando!\",\n\t\t\tephemeral: true,\n\t\t});\n\t\treturn true;\n\t}\n\treturn false;\n};\nconst checkOptions = async (\n\tinteraction: ReceivedInteraction<\"cached\">,\n\toptions: CheckSlowmodeOptions\n) => {\n\tif (!(options.channel && \"setRateLimitPerUser\" in options.channel)) {\n\t\tawait interaction.reply({\n\t\t\tcontent: \"Questa azione non può essere eseguita nel canale selezionato!\",\n\t\t\tephemeral: true,\n\t\t});\n\t\treturn true;\n\t}\n\tif (!options.channel.manageable) {\n\t\tawait interaction.reply({\n\t\t\tcontent: \"Non ho i permessi necessari per gestire il canale selezionato!\",\n\t\t\tephemeral: true,\n\t\t});\n\t\treturn true;\n\t}\n\tif (isNaN(options.rateLimitPerUser)) {\n\t\tawait interaction.reply({\n\t\t\tcontent: \"Hai inserito un valore non valido per la slowmode!\",\n\t\t\tephemeral: true,\n\t\t});\n\t\treturn true;\n\t}\n\tif (options.rateLimitPerUser < 0 || options.rateLimitPerUser > 21600) {\n\t\tawait interaction.reply({\n\t\t\tcontent:\n\t\t\t\t\"La durata della slowmode deve essere compresa tra 0 secondi e 6 ore!\",\n\t\t\tephemeral: true,\n\t\t});\n\t\treturn true;\n\t}\n\tif (options.rateLimitPerUser === options.channel.rateLimitPerUser) {\n\t\tawait interaction.reply({\n\t\t\tcontent: \"La slowmode è già impostata a questo valore!\",\n\t\t\tephemeral: true,\n\t\t});\n\t\treturn true;\n\t}\n\treturn false;\n};\nconst slowmode = async (\n\tinteraction: ReceivedInteraction<\"cached\">,\n\toptions: SlowmodeOptions\n) => {\n\tconst oldSlowmode = options.channel.rateLimitPerUser;\n\tconst result = await options.channel\n\t\t.setRateLimitPerUser(options.rateLimitPerUser, options.reason)\n\t\t.catch(normalizeError);\n\n\tif (result instanceof Error) {\n\t\tawait sendError(interaction, result);\n\t\treturn;\n\t}\n\tawait interaction.reply({\n\t\tcontent: `Slowmode ${\n\t\t\toptions.rateLimitPerUser\n\t\t\t\t? `impostata a **${ms(options.rateLimitPerUser * 1000)}**`\n\t\t\t\t: \"disattivata\"\n\t\t} in <#${options.channel.id}> con successo!`,\n\t\tcomponents: [\n\t\t\t{\n\t\t\t\ttype: ComponentType.ActionRow,\n\t\t\t\tcomponents: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: ComponentType.Button,\n\t\t\t\t\t\tcustom_id: `channel-s-${options.channel.id}-${\n\t\t\t\t\t\t\toptions.rateLimitPerUser || oldSlowmode == null ? 0 : oldSlowmode\n\t\t\t\t\t\t}`,\n\t\t\t\t\t\tlabel:\n\t\t\t\t\t\t\toptions.rateLimitPerUser || oldSlowmode == null\n\t\t\t\t\t\t\t\t? \"Rimuovi\"\n\t\t\t\t\t\t\t\t: \"Annulla\",\n\t\t\t\t\t\tstyle: ButtonStyle.Danger,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t],\n\t});\n};\n\nexport const command = createCommand({\n\tdata: [\n\t\t{\n\t\t\tname: \"channel\",\n\t\t\tdescription: \"Gestisci i canali\",\n\t\t\ttype: ApplicationCommandType.ChatInput,\n\t\t\toptions: [\n\t\t\t\t{\n\t\t\t\t\ttype: ApplicationCommandOptionType.Subcommand,\n\t\t\t\t\tname: \"slowmode\",\n\t\t\t\t\tdescription: \"Imposta o mostra la slowmode\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"duration\",\n\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\"La nuova slowmode (0 per disattivarla, vuoto per mostrare quella attuale)\",\n\t\t\t\t\t\t\ttype: ApplicationCommandOptionType.String,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"reason\",\n\t\t\t\t\t\t\tdescription: \"Il motivo della modifica della slowmode\",\n\t\t\t\t\t\t\ttype: ApplicationCommandOptionType.String,\n\t\t\t\t\t\t\tmax_length: 512,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"channel\",\n\t\t\t\t\t\t\tdescription: \"Il canale da gestire (default: questo canale)\",\n\t\t\t\t\t\t\ttype: ApplicationCommandOptionType.Channel,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t],\n\tasync run(interaction) {\n\t\tif (!interaction.inCachedGuild()) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent:\n\t\t\t\t\t\"Questo comando può essere usato solo all'interno di un server!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tconst [{ options }] = interaction.options.data;\n\n\t\tif (!options) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent: \"Questo comando non è attualmente disponibile!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tif (interaction.options.data[0].name === \"slowmode\") {\n\t\t\tif (options.some((option) => option.name === \"duration\")) {\n\t\t\t\tif (await checkPerms(interaction)) return;\n\t\t\t\tconst slowmodeOptions: CheckSlowmodeOptions = {\n\t\t\t\t\tchannel: interaction.channel,\n\t\t\t\t\trateLimitPerUser: 0,\n\t\t\t\t};\n\n\t\t\t\tfor (const option of options)\n\t\t\t\t\tif (\n\t\t\t\t\t\toption.name === \"channel\" &&\n\t\t\t\t\t\toption.channel &&\n\t\t\t\t\t\t\"client\" in option.channel\n\t\t\t\t\t)\n\t\t\t\t\t\tslowmodeOptions.channel = option.channel;\n\t\t\t\t\telse if (option.name === \"duration\")\n\t\t\t\t\t\tslowmodeOptions.rateLimitPerUser =\n\t\t\t\t\t\t\tms(typeof option.value === \"string\" ? option.value : \"\") || 0;\n\t\t\t\t\telse if (option.name === \"reason\" && typeof option.value === \"string\")\n\t\t\t\t\t\tslowmodeOptions.reason = option.value;\n\t\t\t\tslowmodeOptions.rateLimitPerUser = Math.round(\n\t\t\t\t\tslowmodeOptions.rateLimitPerUser / 1000\n\t\t\t\t);\n\t\t\t\tif (await checkOptions(interaction, slowmodeOptions)) return;\n\t\t\t\tawait slowmode(interaction, slowmodeOptions as SlowmodeOptions);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst tempChannel = interaction.options.getChannel(\"channel\");\n\t\t\tconst channel = !(tempChannel && \"setRateLimitPerUser\" in tempChannel)\n\t\t\t\t? interaction.channel\n\t\t\t\t: tempChannel;\n\n\t\t\tif (!channel) {\n\t\t\t\tawait interaction.reply({\n\t\t\t\t\tcontent: \"Canale non valido!\",\n\t\t\t\t\tephemeral: true,\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent:\n\t\t\t\t\tchannel.rateLimitPerUser ?? 0\n\t\t\t\t\t\t? `Slowmode attiva in <#${channel.id}> ogni **${ms(\n\t\t\t\t\t\t\t\tchannel.rateLimitPerUser! * 1000\n\t\t\t\t\t\t  )}**.`\n\t\t\t\t\t\t: `Slowmode non attiva in <#${channel.id}>.`,\n\t\t\t});\n\t\t}\n\t},\n\tasync component(interaction) {\n\t\tif (!interaction.inCachedGuild()) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent:\n\t\t\t\t\t\"Questo comando può essere usato solo all'interno di un server!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tconst [, action, ...args] = interaction.customId.split(\"-\");\n\t\tif (!action || ![\"s\"].includes(action)) {\n\t\t\tawait interaction.reply({\n\t\t\t\tcontent: \"Azione non valida!\",\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t\tif (action === \"s\") {\n\t\t\tif (await checkPerms(interaction)) return;\n\t\t\tconst options: CheckSlowmodeOptions = {\n\t\t\t\tchannel:\n\t\t\t\t\tinteraction.guild.channels.cache.get(args[0]) ?? interaction.channel,\n\t\t\t\trateLimitPerUser: Number(args[1]) || 0,\n\t\t\t};\n\n\t\t\tif (await checkOptions(interaction, options)) return;\n\t\t\tawait slowmode(interaction, options as SlowmodeOptions);\n\t\t}\n\t},\n});\n"],"mappings":"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","names":[]}