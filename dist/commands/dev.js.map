{"version":3,"sources":["../../src/commands/dev.ts"],"sourcesContent":["import {\r\n\tbold,\r\n\tcodeBlock,\r\n\tinlineCode,\r\n\tSlashCommandBuilder,\r\n\ttime,\r\n\tTimestampStyles,\r\n} from \"@discordjs/builders\";\r\nimport { ComponentType, TextInputStyle } from \"discord-api-types/v10\";\r\nimport { Colors, escapeCodeBlock, escapeInlineCode } from \"discord.js\";\r\nimport type { Buffer } from \"node:buffer\";\r\nimport type { ChildProcess } from \"node:child_process\";\r\nimport { exec, execFile } from \"node:child_process\";\r\nimport { createReadStream, createWriteStream } from \"node:fs\";\r\nimport { unlink } from \"node:fs/promises\";\r\nimport {\r\n\targv,\r\n\tcwd,\r\n\tenv,\r\n\texit,\r\n\tmemoryUsage,\r\n\tstderr,\r\n\tstdout,\r\n\tuptime,\r\n} from \"node:process\";\r\nimport type { CommandOptions } from \"../util\";\r\nimport { CustomClient, restart } from \"../util\";\r\n\r\nenum SubCommands {\r\n\tshell = \"shell\",\r\n\tevalCmd = \"eval\",\r\n\ttest = \"test\",\r\n\tram = \"ram\",\r\n\trestartCmd = \"restart\",\r\n\tshutdown = \"shutdown\",\r\n\tuptimeCmd = \"uptime\",\r\n\tpull = \"pull\",\r\n\tcpp = \"cpp\",\r\n\tlogs = \"logs\",\r\n}\r\nenum Options {\r\n\tcmd = \"cmd\",\r\n\tephemeral = \"ephemeral\",\r\n\tprocess = \"process\",\r\n\trebuild = \"rebuild\",\r\n\tregisterCommands = \"synccommands\",\r\n\trestartProcess = \"restart\",\r\n\tpackages = \"packages\",\r\n\tcode = \"code\",\r\n\tinclude = \"include\",\r\n\tnamespaces = \"namespaces\",\r\n\tlines = \"lines\",\r\n}\r\n\r\nconst bytesToMb = (memory: number) =>\r\n\t\tMath.round((memory / 1024 / 1024) * 100) / 100,\r\n\tcommaRegex = /,\\s{0,}/g;\r\n\r\nexport const command: CommandOptions = {\r\n\tdata: new SlashCommandBuilder()\r\n\t\t.setName(\"dev\")\r\n\t\t.setDescription(\"Comandi privati disponibili solo ai sviluppatori\")\r\n\t\t.setDefaultPermission(false)\r\n\t\t.addSubcommand((shell) =>\r\n\t\t\tshell\r\n\t\t\t\t.setName(SubCommands.shell)\r\n\t\t\t\t.setDescription(\"Esegue un comando nel terminal\")\r\n\t\t\t\t.addStringOption((cmd) =>\r\n\t\t\t\t\tcmd\r\n\t\t\t\t\t\t.setName(Options.cmd)\r\n\t\t\t\t\t\t.setDescription(\"Comando da eseguire\")\r\n\t\t\t\t\t\t.setRequired(true)\r\n\t\t\t\t)\r\n\t\t\t\t.addBooleanOption((ephemeral) =>\r\n\t\t\t\t\tephemeral\r\n\t\t\t\t\t\t.setName(Options.ephemeral)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Scegli se mostrare il risultato privatamente (default: true)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t)\r\n\t\t.addSubcommand((evalCmd) =>\r\n\t\t\tevalCmd\r\n\t\t\t\t.setName(SubCommands.evalCmd)\r\n\t\t\t\t.setDescription(\"Esegue del codice\")\r\n\t\t\t\t.addBooleanOption((ephemeral) =>\r\n\t\t\t\t\tephemeral\r\n\t\t\t\t\t\t.setName(Options.ephemeral)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Scegli se mostrare il risultato privatamente (default: true)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t)\r\n\t\t.addSubcommand((ram) =>\r\n\t\t\tram\r\n\t\t\t\t.setName(SubCommands.ram)\r\n\t\t\t\t.setDescription(\"Mostra la RAM utilizzata\")\r\n\t\t\t\t.addBooleanOption((ephemeral) =>\r\n\t\t\t\t\tephemeral\r\n\t\t\t\t\t\t.setName(Options.ephemeral)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Scegli se mostrare il risultato privatamente (default: true)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t)\r\n\t\t.addSubcommand((restartCmd) =>\r\n\t\t\trestartCmd\r\n\t\t\t\t.setName(SubCommands.restartCmd)\r\n\t\t\t\t.setDescription(\"Riavvia il bot\")\r\n\t\t\t\t.addBooleanOption((process) =>\r\n\t\t\t\t\tprocess\r\n\t\t\t\t\t\t.setName(Options.process)\r\n\t\t\t\t\t\t.setDescription(\"Se riavviare il processo (default: true)\")\r\n\t\t\t\t)\r\n\t\t\t\t.addBooleanOption((ephemeral) =>\r\n\t\t\t\t\tephemeral\r\n\t\t\t\t\t\t.setName(Options.ephemeral)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Scegli se mostrare il risultato privatamente (default: true)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t)\r\n\t\t.addSubcommand((shutdown) =>\r\n\t\t\tshutdown\r\n\t\t\t\t.setName(SubCommands.shutdown)\r\n\t\t\t\t.setDescription(\"Spegni il bot\")\r\n\t\t\t\t.addBooleanOption((ephemeral) =>\r\n\t\t\t\t\tephemeral\r\n\t\t\t\t\t\t.setName(Options.ephemeral)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Scegli se mostrare il risultato privatamente (default: true)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t)\r\n\t\t.addSubcommand((uptimeCmd) =>\r\n\t\t\tuptimeCmd\r\n\t\t\t\t.setName(SubCommands.uptimeCmd)\r\n\t\t\t\t.setDescription(\"Mostra l'uptime del bot\")\r\n\t\t\t\t.addBooleanOption((ephemeral) =>\r\n\t\t\t\t\tephemeral\r\n\t\t\t\t\t\t.setName(Options.ephemeral)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Scegli se mostrare il risultato privatamente (default: true)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t)\r\n\t\t.addSubcommand((pull) =>\r\n\t\t\tpull\r\n\t\t\t\t.setName(SubCommands.pull)\r\n\t\t\t\t.setDescription(\"Aggiorna il bot\")\r\n\t\t\t\t.addBooleanOption((rebuild) =>\r\n\t\t\t\t\trebuild\r\n\t\t\t\t\t\t.setName(Options.rebuild)\r\n\t\t\t\t\t\t.setDescription(\"Ricompila il progetto con i nuovi cambiamenti\")\r\n\t\t\t\t)\r\n\t\t\t\t.addBooleanOption((registerCommands) =>\r\n\t\t\t\t\tregisterCommands\r\n\t\t\t\t\t\t.setName(Options.registerCommands)\r\n\t\t\t\t\t\t.setDescription(\"Sincronizza i comandi con Discord\")\r\n\t\t\t\t)\r\n\t\t\t\t.addBooleanOption((restartProcess) =>\r\n\t\t\t\t\trestartProcess\r\n\t\t\t\t\t\t.setName(Options.restartProcess)\r\n\t\t\t\t\t\t.setDescription(\"Riavvia il processo\")\r\n\t\t\t\t)\r\n\t\t\t\t.addBooleanOption((packages) =>\r\n\t\t\t\t\tpackages\r\n\t\t\t\t\t\t.setName(Options.packages)\r\n\t\t\t\t\t\t.setDescription(\"Aggiorna i pacchetti\")\r\n\t\t\t\t)\r\n\t\t\t\t.addBooleanOption((ephemeral) =>\r\n\t\t\t\t\tephemeral\r\n\t\t\t\t\t\t.setName(Options.ephemeral)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Scegli se mostrare il risultato privatamente (default: true)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t)\r\n\t\t.addSubcommand((cpp) =>\r\n\t\t\tcpp\r\n\t\t\t\t.setName(SubCommands.cpp)\r\n\t\t\t\t.setDescription(\"Compila il codice\")\r\n\t\t\t\t.addStringOption((code) =>\r\n\t\t\t\t\tcode\r\n\t\t\t\t\t\t.setName(Options.code)\r\n\t\t\t\t\t\t.setDescription(\"Codice da compilare\")\r\n\t\t\t\t\t\t.setRequired(true)\r\n\t\t\t\t)\r\n\t\t\t\t.addStringOption((include) =>\r\n\t\t\t\t\tinclude\r\n\t\t\t\t\t\t.setName(Options.include)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Librerie da includere, separate da virgola (default: iostream)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t\t\t.addStringOption((namespaces) =>\r\n\t\t\t\t\tnamespaces\r\n\t\t\t\t\t\t.setName(Options.namespaces)\r\n\t\t\t\t\t\t.setDescription(\"Namespaces da usare (default: std)\")\r\n\t\t\t\t)\r\n\t\t\t\t.addBooleanOption((ephemeral) =>\r\n\t\t\t\t\tephemeral\r\n\t\t\t\t\t\t.setName(Options.ephemeral)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Scegli se mostrare il risultato privatamente (default: true)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t)\r\n\t\t.addSubcommand((logs) =>\r\n\t\t\tlogs\r\n\t\t\t\t.setName(SubCommands.logs)\r\n\t\t\t\t.setDescription(\"Mostra i log del bot\")\r\n\t\t\t\t.addIntegerOption((lines) =>\r\n\t\t\t\t\tlines\r\n\t\t\t\t\t\t.setName(Options.lines)\r\n\t\t\t\t\t\t.setDescription(\"Numero di righe da mostrare (default: max)\")\r\n\t\t\t\t)\r\n\t\t\t\t.addBooleanOption((ephemeral) =>\r\n\t\t\t\t\tephemeral\r\n\t\t\t\t\t\t.setName(Options.ephemeral)\r\n\t\t\t\t\t\t.setDescription(\r\n\t\t\t\t\t\t\t\"Scegli se mostrare il risultato privatamente (default: true)\"\r\n\t\t\t\t\t\t)\r\n\t\t\t\t)\r\n\t\t)\r\n\t\t.addSubcommand((test) =>\r\n\t\t\ttest.setName(SubCommands.test).setDescription(\"Un comando di test\")\r\n\t\t),\r\n\tasync run(interaction) {\r\n\t\tconst ephemeral = interaction.options.getBoolean(Options.ephemeral) ?? true,\r\n\t\t\tsubCommand = interaction.options.getSubcommand();\r\n\r\n\t\tif (subCommand !== SubCommands.evalCmd)\r\n\t\t\tawait interaction.deferReply({\r\n\t\t\t\tephemeral,\r\n\t\t\t});\r\n\t\tconst now = Date.now();\r\n\t\tlet botUptime: Date,\r\n\t\t\tchild: ChildProcess,\r\n\t\t\tcmd: string,\r\n\t\t\tcode: string,\r\n\t\t\terror: Error | undefined,\r\n\t\t\texitCode: number,\r\n\t\t\tlines: number | null,\r\n\t\t\tlogs: string[],\r\n\t\t\tmemory: NodeJS.MemoryUsage,\r\n\t\t\toutput: string,\r\n\t\t\tprocessUptime: Date;\r\n\r\n\t\tswitch (subCommand) {\r\n\t\t\tcase SubCommands.shell:\r\n\t\t\t\tcmd = interaction.options.getString(Options.cmd, true);\r\n\t\t\t\tchild = exec(cmd);\r\n\t\t\t\toutput = \"\";\r\n\t\t\t\tchild.stdout?.on(\"data\", (data: Buffer) => (output += data.toString()));\r\n\t\t\t\tchild.stderr?.on(\"data\", (data: Buffer) => (output += data.toString()));\r\n\t\t\t\tchild.stderr?.pipe(stderr);\r\n\t\t\t\tchild.stdout?.pipe(stdout);\r\n\t\t\t\texitCode = await new Promise((resolve) => {\r\n\t\t\t\t\tchild.once(\"close\", resolve);\r\n\t\t\t\t});\r\n\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\tcontent: `Comando eseguito in ${Date.now() - now}ms\\n${inlineCode(\r\n\t\t\t\t\t\t`${cwd()}> ${escapeInlineCode(cmd.slice(0, 2000 - 100))}`\r\n\t\t\t\t\t)}`,\r\n\t\t\t\t\tembeds: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tauthor: {\r\n\t\t\t\t\t\t\t\tname: interaction.user.tag,\r\n\t\t\t\t\t\t\t\ticon_url: interaction.user.displayAvatarURL(),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\ttitle: \"Output\",\r\n\t\t\t\t\t\t\tdescription: codeBlock(\r\n\t\t\t\t\t\t\t\tescapeCodeBlock(output.slice(0, 4096 - 7))\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\tcolor: exitCode ? Colors.Red : Colors.Green,\r\n\t\t\t\t\t\t\ttimestamp: new Date().toISOString(),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase SubCommands.evalCmd:\r\n\t\t\t\tawait interaction.showModal({\r\n\t\t\t\t\ttitle: \"Eval\",\r\n\t\t\t\t\tcustom_id: `eval-${ephemeral ? \"eph\" : \"\"}`,\r\n\t\t\t\t\tcomponents: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttype: ComponentType.ActionRow,\r\n\t\t\t\t\t\t\tcomponents: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tlabel: \"TypeScript code\",\r\n\t\t\t\t\t\t\t\t\tstyle: TextInputStyle.Paragraph,\r\n\t\t\t\t\t\t\t\t\tcustom_id: \"code\",\r\n\t\t\t\t\t\t\t\t\ttype: ComponentType.TextInput,\r\n\t\t\t\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\t\t\t\tplaceholder:\r\n\t\t\t\t\t\t\t\t\t\t\"The code to be formatted with Prettier and compiled by TypeScript...\",\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t],\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase SubCommands.ram:\r\n\t\t\t\tmemory = memoryUsage();\r\n\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\tcontent: `Memoria calcolata in ${Date.now() - now}ms`,\r\n\t\t\t\t\tembeds: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tauthor: {\r\n\t\t\t\t\t\t\t\tname: interaction.user.tag,\r\n\t\t\t\t\t\t\t\ticon_url: interaction.user.displayAvatarURL(),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\ttitle: \"RAM\",\r\n\t\t\t\t\t\t\tdescription: `${bold(\"Resident Set Size\")}: ${bytesToMb(\r\n\t\t\t\t\t\t\t\tmemory.rss\r\n\t\t\t\t\t\t\t)} MB\\n${bold(\"Heap Total\")}: ${bytesToMb(\r\n\t\t\t\t\t\t\t\tmemory.heapTotal\r\n\t\t\t\t\t\t\t)} MB\\n${bold(\"Heap Used\")}: ${bytesToMb(\r\n\t\t\t\t\t\t\t\tmemory.heapUsed\r\n\t\t\t\t\t\t\t)} MB\\n${bold(\"External\")}: ${bytesToMb(memory.external)} MB`,\r\n\t\t\t\t\t\t\tcolor: Math.round(((memory.rss / 1024 / 1024) * 16777215) / 500),\r\n\t\t\t\t\t\t\ttimestamp: new Date().toISOString(),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase SubCommands.restartCmd:\r\n\t\t\t\tif (interaction.options.getBoolean(Options.process) ?? true) {\r\n\t\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\t\tcontent: `Sto facendo ripartire il programma con i seguenti argv:\\n${argv\r\n\t\t\t\t\t\t\t.map((arg) => inlineCode(escapeInlineCode(arg)))\r\n\t\t\t\t\t\t\t.join(\"\\n\")}`,\r\n\t\t\t\t\t});\r\n\t\t\t\t\trestart(this.client);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.client.destroy();\r\n\t\t\t\t\tthis.client.token = env.DISCORD_TOKEN!;\r\n\t\t\t\t\tawait this.client.login();\r\n\t\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\t\tcontent: `Ricollegato in ${Date.now() - now}ms.`,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase SubCommands.shutdown:\r\n\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\tcontent: `Sto spegnendo il bot...`,\r\n\t\t\t\t});\r\n\t\t\t\tthis.client.destroy();\r\n\t\t\t\treturn exit(0);\r\n\t\t\tcase SubCommands.uptimeCmd:\r\n\t\t\t\tprocessUptime = new Date(Date.now() - uptime() * 1000);\r\n\t\t\t\tbotUptime = new Date(Date.now() - this.client.uptime);\r\n\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\tcontent: `Process uptime calcolato in ${bold(\r\n\t\t\t\t\t\t`${Date.now() - now}ms`\r\n\t\t\t\t\t)}`,\r\n\t\t\t\t\tembeds: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tauthor: {\r\n\t\t\t\t\t\t\t\tname: interaction.user.tag,\r\n\t\t\t\t\t\t\t\ticon_url: interaction.user.displayAvatarURL(),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\ttitle: \"Uptime\",\r\n\t\t\t\t\t\t\tdescription: `${bold(\"Processo\")}: ${time(\r\n\t\t\t\t\t\t\t\tprocessUptime,\r\n\t\t\t\t\t\t\t\tTimestampStyles.RelativeTime\r\n\t\t\t\t\t\t\t)} (${time(processUptime)})\\n${bold(\"Bot\")}: ${time(\r\n\t\t\t\t\t\t\t\tbotUptime,\r\n\t\t\t\t\t\t\t\tTimestampStyles.RelativeTime\r\n\t\t\t\t\t\t\t)} (${time(botUptime)})`,\r\n\t\t\t\t\t\t\tcolor: Colors.Blurple,\r\n\t\t\t\t\t\t\ttimestamp: new Date().toISOString(),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase SubCommands.cpp:\r\n\t\t\t\tconst codeOption = interaction.options.getString(Options.code, true);\r\n\r\n\t\t\t\tcode = `${(interaction.options.getString(Options.include) ?? \"iostream\")\r\n\t\t\t\t\t.split(commaRegex)\r\n\t\t\t\t\t.map((include) => `#include <${include}>`)\r\n\t\t\t\t\t.join(\"\\n\")}\\n${(\r\n\t\t\t\t\tinteraction.options.getString(Options.namespaces) ?? \"std\"\r\n\t\t\t\t)\r\n\t\t\t\t\t.split(commaRegex)\r\n\t\t\t\t\t.map((namespace) => `using namespace ${namespace};`)\r\n\t\t\t\t\t.join(\"\\n\")}\\n\\nint main() {\\n\\t${codeOption}${\r\n\t\t\t\t\tcodeOption.endsWith(\";\") ? \"\" : \";\"\r\n\t\t\t\t}\\n}`;\r\n\t\t\t\terror = await new Promise((resolve) => {\r\n\t\t\t\t\tcreateWriteStream(\"./tmp/cpp.cpp\")\r\n\t\t\t\t\t\t.once(\"error\", resolve)\r\n\t\t\t\t\t\t.once(\"finish\", resolve)\r\n\t\t\t\t\t\t.setDefaultEncoding(\"utf8\")\r\n\t\t\t\t\t\t.end(code);\r\n\t\t\t\t});\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\tCustomClient.printToStderr(error);\r\n\t\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\t\tcontent: `Errore durante la creazione del file: ${CustomClient.inspect(\r\n\t\t\t\t\t\t\terror\r\n\t\t\t\t\t\t)}`,\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tchild = exec(\"g++ ./tmp/cpp.cpp -o ./tmp/cpp.exe\");\r\n\t\t\t\toutput = \"\";\r\n\t\t\t\tchild.stdout?.on(\"data\", (data) => (output += data));\r\n\t\t\t\tchild.stderr?.on(\"data\", (data) => (output += data));\r\n\t\t\t\tchild.stdout?.pipe(stdout);\r\n\t\t\t\tchild.stderr?.pipe(stderr);\r\n\t\t\t\texitCode = await new Promise((resolve) => {\r\n\t\t\t\t\tchild.once(\"close\", resolve);\r\n\t\t\t\t});\r\n\t\t\t\tunlink(\"./tmp/cpp.cpp\").catch(CustomClient.printToStderr);\r\n\t\t\t\tif (exitCode) {\r\n\t\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\t\tcontent: `Errore durante la compilazione del codice C++\\nCodice di errore: ${exitCode}`,\r\n\t\t\t\t\t\tembeds: [\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tauthor: {\r\n\t\t\t\t\t\t\t\t\tname: interaction.user.tag,\r\n\t\t\t\t\t\t\t\t\ticon_url: interaction.user.displayAvatarURL(),\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\ttitle: \"Output\",\r\n\t\t\t\t\t\t\t\tdescription: codeBlock(\r\n\t\t\t\t\t\t\t\t\tescapeCodeBlock(output.slice(0, 4096 - 7))\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\tcolor: Colors.Red,\r\n\t\t\t\t\t\t\t\ttimestamp: new Date().toISOString(),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tauthor: {\r\n\t\t\t\t\t\t\t\t\tname: interaction.user.tag,\r\n\t\t\t\t\t\t\t\t\ticon_url: interaction.user.displayAvatarURL(),\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\ttitle: \"Codice C++\",\r\n\t\t\t\t\t\t\t\tdescription: codeBlock(\r\n\t\t\t\t\t\t\t\t\t\"cpp\",\r\n\t\t\t\t\t\t\t\t\tescapeCodeBlock(code.slice(0, 4096 - 7))\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\tcolor: Colors.Blurple,\r\n\t\t\t\t\t\t\t\ttimestamp: new Date().toISOString(),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t],\r\n\t\t\t\t\t});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tconst collector = interaction.channel?.createMessageCollector({\r\n\t\t\t\t\tfilter: (m) => m.author.id === interaction.user.id,\r\n\t\t\t\t});\r\n\t\t\t\tconst onData = (data: Buffer) => {\r\n\t\t\t\t\toutput += data;\r\n\t\t\t\t\tinteraction\r\n\t\t\t\t\t\t.editReply({\r\n\t\t\t\t\t\t\tcontent: output,\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch(CustomClient.printToStderr);\r\n\t\t\t\t};\r\n\r\n\t\t\t\toutput = \"\";\r\n\t\t\t\tchild = execFile(\"./tmp/cpp.exe\");\r\n\t\t\t\tchild.stderr?.on(\"data\", onData);\r\n\t\t\t\tchild.stdout?.on(\"data\", onData);\r\n\t\t\t\tcollector?.on(\"collect\", (message) => {\r\n\t\t\t\t\tconst input = `${message.content}\\n`;\r\n\r\n\t\t\t\t\tmessage.delete().catch(CustomClient.printToStderr);\r\n\t\t\t\t\toutput += input;\r\n\t\t\t\t\tchild.stdin?.write(input);\r\n\t\t\t\t});\r\n\t\t\t\texitCode = await new Promise((resolve) => {\r\n\t\t\t\t\tchild.once(\"close\", resolve);\r\n\t\t\t\t});\r\n\t\t\t\tcollector?.stop();\r\n\t\t\t\tunlink(\"./tmp/cpp.exe\").catch(CustomClient.printToStderr);\r\n\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\tcontent: `${output}\\n\\n**Processo terminato in ${\r\n\t\t\t\t\t\tDate.now() - now\r\n\t\t\t\t\t}ms con codice ${exitCode}**`,\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase SubCommands.logs:\r\n\t\t\t\tlogs = await new Promise<string[]>((resolve) => {\r\n\t\t\t\t\tlet data = \"\";\r\n\r\n\t\t\t\t\tcreateReadStream(`./debug.log`)\r\n\t\t\t\t\t\t.setEncoding(\"utf8\")\r\n\t\t\t\t\t\t.on(\"data\", (chunk) => (data += chunk))\r\n\t\t\t\t\t\t.once(\"end\", () => {\r\n\t\t\t\t\t\t\tresolve(data.split(\"\\n\"));\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.once(\"error\", (err) => {\r\n\t\t\t\t\t\t\tinteraction\r\n\t\t\t\t\t\t\t\t.editReply({\r\n\t\t\t\t\t\t\t\t\tcontent: `Errore durante la lettura del file di log: ${CustomClient.inspect(\r\n\t\t\t\t\t\t\t\t\t\terr\r\n\t\t\t\t\t\t\t\t\t)}`,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch(CustomClient.printToStderr);\r\n\t\t\t\t\t\t\tresolve([]);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tif (!logs.length) break;\r\n\t\t\t\tconst { length } = logs;\r\n\r\n\t\t\t\tlines = interaction.options.getInteger(Options.lines);\r\n\t\t\t\tif (lines != null && lines > 0)\r\n\t\t\t\t\tlogs = logs.slice(Math.max(0, length - lines - 1));\r\n\t\t\t\twhile (logs.join(\"\\n\").length > 4096 - 7) logs.shift();\r\n\t\t\t\tawait interaction.editReply({\r\n\t\t\t\t\tcontent: `Logs letti in ${\r\n\t\t\t\t\t\tDate.now() - now\r\n\t\t\t\t\t}ms\\nRighe totali: ${length}\\nRighe visualizzate: ${logs.length}`,\r\n\t\t\t\t\tembeds: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tauthor: {\r\n\t\t\t\t\t\t\t\tname: interaction.user.tag,\r\n\t\t\t\t\t\t\t\ticon_url: interaction.user.displayAvatarURL(),\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\ttitle: \"Logs\",\r\n\t\t\t\t\t\t\tdescription: codeBlock(\r\n\t\t\t\t\t\t\t\tescapeCodeBlock(logs.slice(0, 4096 - 7).join(\"\\n\"))\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\tcolor: Colors.Blurple,\r\n\t\t\t\t\t\t\ttimestamp: new Date().toISOString(),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t],\r\n\t\t\t\t});\r\n\t\t\t\tbreak;\r\n\t\t\tcase SubCommands.test:\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tawait interaction.editReply(\"Comando non riconosciuto\");\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t},\r\n};\r\n"],"mappings":"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","names":[]}